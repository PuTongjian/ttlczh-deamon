# 调试指南

## 问题：管理员权限下窗口不显示

在 Windows 上，当以管理员权限运行 Electron 应用时，由于 UAC（用户账户控制）的限制，窗口可能不会显示。本指南提供了多种调试方法。

## 调试方法

### 方法 1：使用调试脚本（推荐）

我们提供了两个调试启动脚本：

#### PowerShell 版本（推荐）
```powershell
.\debug.ps1
```

#### 批处理版本
```cmd
debug.bat
```

这些脚本会：
- 自动检测是否以管理员权限运行
- 提供启动选项（开发模式、仅 Electron、查看日志）
- 显示日志文件位置

### 方法 2：查看日志文件

应用会自动记录日志到以下位置：
```
%APPDATA%\electron-wss-daemon-manager\logs\app-YYYY-MM-DD.log
```

日志包含：
- 应用启动信息
- 窗口创建和显示状态
- 错误信息
- 管理员权限检测结果

### 方法 3：手动启动并查看控制台

1. **以管理员权限打开 PowerShell**
   ```powershell
   # 右键点击 PowerShell，选择"以管理员身份运行"
   ```

2. **导航到项目目录**
   ```powershell
   cd "项目路径"
   ```

3. **启动开发模式**
   ```powershell
   npm run dev
   ```

4. **查看控制台输出**
   - 所有日志都会输出到控制台
   - 检查是否有错误信息
   - 确认窗口是否已创建

### 方法 4：检查窗口状态

如果应用启动但没有显示窗口，可以：

1. **检查任务栏**
   - 查看任务栏是否有应用图标
   - 尝试点击图标

2. **使用 Alt+Tab**
   - 按 Alt+Tab 查看是否有应用窗口
   - 可能窗口在后台或被最小化

3. **检查日志**
   - 查看日志文件中的窗口创建和显示事件
   - 查找 "Window ready to show" 和 "Window shown and focused" 消息

## 已实现的修复

### 1. 窗口显示增强
- 明确设置 `show: true`
- 设置 `skipTaskbar: false`
- 在 `ready-to-show` 事件中强制显示和聚焦窗口
- 使用 `moveTop()` 确保窗口在前台

### 2. 日志系统
- 自动创建日志目录
- 同时输出到控制台和日志文件
- 记录所有关键事件和错误

### 3. 错误处理
- 捕获未处理的异常
- 捕获未处理的 Promise 拒绝
- 记录所有错误到日志文件

### 4. 管理员权限检测
- 自动检测是否以管理员权限运行
- 在日志中记录权限状态

## 常见问题

### Q: 为什么需要管理员权限？

A: 以下操作需要管理员权限：
- 导入证书到系统证书存储
- 修改 hosts 文件
- 设置开机自启动（某些情况下）

### Q: 如何在不使用管理员权限的情况下调试？

A: 可以：
1. 使用普通权限启动应用（`npm run dev`）
2. 当需要权限的操作时，应用会提示或失败
3. 查看日志文件了解具体错误

### Q: 窗口仍然不显示怎么办？

A: 尝试以下步骤：
1. 检查日志文件，查看是否有错误
2. 检查防火墙或安全软件是否阻止了窗口显示
3. 尝试在非管理员模式下启动，看窗口是否正常显示
4. 检查是否有多个显示器，窗口可能在其他显示器上

### Q: 如何查看实时日志？

A: 可以使用以下 PowerShell 命令：
```powershell
Get-Content "$env:APPDATA\electron-wss-daemon-manager\logs\app-$(Get-Date -Format 'yyyy-MM-dd).log" -Wait -Tail 50
```

## 调试技巧

1. **启用开发者工具**
   - 开发模式下会自动打开开发者工具
   - 可以在渲染进程中查看控制台错误

2. **使用 IPC 调试**
   - 在渲染进程中使用 `window.electronAPI.getLogPath()` 获取日志路径
   - 可以添加一个按钮来打开日志文件

3. **检查进程**
   - 使用任务管理器查看 Electron 进程是否在运行
   - 检查是否有多个实例

4. **网络调试**
   - 如果 Vite 开发服务器未启动，窗口可能无法加载内容
   - 检查 `http://localhost:5173` 是否可访问

## 联系支持

如果问题仍然存在，请提供：
1. 日志文件的完整内容
2. 操作系统版本
3. 启动方式（管理员/普通权限）
4. 控制台输出的错误信息

